/*! angular-scheduler 12-02-2015 */
angular.module("grid",[]).directive("grid",[function(){return{scope:{min:"=",max:"=",tick:"="},restrict:"E",templateUrl:"templates/grid.html",link:function(a){a.range=function(a){return new Array(a)},a.tickcount=(a.max-a.min)/a.tick,a.ticksize=100/a.tickcount}}}]),angular.module("handle",[]).directive("handle",["$document",function(a){return{scope:{ondrag:"=",ondragstop:"=",ondragstart:"="},restrict:"A",link:function(b,c){function d(a){var c=a.pageX-f;b.ondrag(c)}function e(){a.unbind("mousemove",d),a.unbind("mouseup",e),b.ondragstop&&b.ondragstop()}var f=0;c.on("mousedown",function(c){c.preventDefault(),f=c.pageX,a.on("mousemove",d),a.on("mouseup",e),b.ondragstart&&b.ondragstart()})}}}]),angular.module("multislider",["slot"]).filter("byDay",[function(){return function(a,b){var c=[];return angular.forEach(a,function(a){a.day===b&&c.push(a)}),c}}]).directive("multiSlider",[function(){return{scope:{slots:"=",max:"=",min:"=",tick:"=",defaultValue:"=",day:"="},restrict:"E",templateUrl:"templates/multi-slider.html",link:function(a,b){var c=b[0].getBoundingClientRect().left,d=function(c){var d=c/(a.max-a.min);return Math.floor(d*b[0].clientWidth+.5)},e=function(c){var d=c/b[0].clientWidth;return Math.floor(d*(a.max-a.min)+.5)},f=function(b){return a.tick*Math.round(b/a.tick)},g=function(b,c){b=b>=a.min?b:a.min,c=c<=a.max?c:a.max,a.slots.push({start:b,stop:c,day:a.day}),a.$apply()},h=angular.element(b.find("div")[0]),i=d(a.defaultValue);h.css({width:i+"px"}),b.on("mousemove",function(a){h.css({left:a.pageX-c-i/2+"px"})}),h.on("click",function(d){if(!b.attr("no-add")){var h=d.pageX-c,i=e(h),j=f(i-a.defaultValue/2),k=j+a.defaultValue;g(j,k)}})}}}]),angular.module("scheduler",["multislider","grid"]).filter("intToTime",[function(){return function(a){function b(a,b){return a+="",a.length>=b?a:new Array(b-a.length+1).join("0")+a}var c=Math.floor(a/60),d=a%60;return b(c,2)+":"+b(d,2)}}]).directive("scheduler",[function(){return{templateUrl:"templates/scheduler.html",restrict:"E",scope:{slots:"="},link:function(a){a.labels=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"]}}}]),angular.module("slot",["handle"]).directive("slot",[function(){return{scope:{min:"=",max:"=",model:"=",slots:"=",tick:"="},restrict:"E",templateUrl:"templates/slot.html",link:function(a,b){a.$watch("model",function(){j()},!0);var c=b.parent()[0],d=!0,e={start:a.model.start,stop:a.model.stop},f=function(b){var d=b/(a.max-a.min);return Math.floor(d*c.clientWidth+.5)},g=function(b){return b/(a.max-a.min)*100},h=function(b){var d=b/c.clientWidth;return Math.floor(d*(a.max-a.min)+.5)},i=function(b){return a.tick*Math.round(b/a.tick)},j=function(){var c=g(a.model.start),d=g(a.model.stop-a.model.start);b.css({left:c+"%",width:d+"%"})};a.stopDrag=function(){setTimeout(function(){angular.element(c).removeAttr("no-add")},500),b.removeClass("active"),angular.element(c).removeClass("dragging"),l()},a.startResizeStart=function(){d=!0,a.startDrag()},a.startResizeStop=function(){d=!1,a.startDrag()},a.startDrag=function(){b.addClass("active"),angular.element(c).addClass("dragging"),angular.element(c).attr("no-add",!0),e={start:a.model.start,stop:a.model.stop}},a.resize=function(b){if(d){var c=i(h(f(e.start)+b));c<=a.model.stop&&c>=a.min&&(a.model.start=c,k(),a.$apply())}else{var g=i(h(f(e.stop)+b));g>=a.model.start&&g<=a.max&&(a.model.stop=g,k(),a.$apply())}},a.drag=function(b){var c=a.model.stop-a.model.start,d=i(h(f(e.start)+b));d>=a.min&&d+c<=a.max&&(a.model.start=d,a.model.stop=d+c,a.$apply())};var k=function(){if(a.model.start>=a.model.stop){var b=e.stop;e.stop=e.start,e.start=b,d=!d}},l=function(b){angular.forEach(a.slots,function(b){b!==a.model&&b.day===a.model.day&&(b.stop>=a.model.stop&&b.start<=a.model.start?(a.slots.splice(a.slots.indexOf(b),1),a.model.stop=b.stop,a.model.start=b.start):a.model.stop>=b.stop&&a.model.start<=b.start?a.slots.splice(a.slots.indexOf(b),1):b.stop>=a.model.start&&b.stop<=a.model.stop?(a.slots.splice(a.slots.indexOf(b),1),a.model.start=b.start):b.start>=a.model.start&&b.start<=a.model.stop&&(a.slots.splice(a.slots.indexOf(b),1),a.model.stop=b.stop))}),b||a.$apply()},m=function(){angular.element(c).removeClass("dragging"),angular.element(c).removeClass("slot-hover"),a.slots.splice(a.slots.indexOf(a.model),1)};b.bind("contextmenu",function(a){a.preventDefault(),m()}),b.on("mouseover",function(){angular.element(c).addClass("slot-hover")}),b.on("mouseleave",function(){angular.element(c).removeClass("slot-hover")}),l(!0)}}}]);